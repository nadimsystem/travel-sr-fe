<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sutan Raya - 360 Viewer (Advanced Gyro)</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pannellum@2.5.6/build/pannellum.css" />
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/pannellum@2.5.6/build/pannellum.js"></script>

    <style>
         :root {
            --sutan-dark: #121212;
            --sutan-gold: #d4af37;
        }
        
        body {
            background-color: var(--sutan-dark);
            color: white;
            font-family: "Plus Jakarta Sans", sans-serif;
        }
    </style>
</head>

<body class="antialiased">
    <div id="app"></div>

    <script>
        const {
            createApp,
            ref,
            onMounted,
            onUnmounted,
            computed
        } = Vue;

        createApp({
            setup() {
                // --- State Management ---
                const viewer = ref(null);
                const isGyroSupported = ref(false);
                const isPermanentlyOff = ref(false);
                const deactivationClicks = ref(0);
                const isTemporarilyPaused = ref(false);

                // Konstanta untuk kode yang lebih mudah dibaca
                const MAX_DEACTIVATION_CLICKS = 3;

                // --- Computed Properties ---
                // Logika untuk teks tombol dipindahkan ke sini
                const buttonText = computed(() => {
                    if (isPermanentlyOff.value) {
                        return 'Giroskop Dimatikan';
                    }
                    return `Matikan Giroskop (${deactivationClicks.value}/${MAX_DEACTIVATION_CLICKS})`;
                });

                // --- Event Handlers ---
                const handleManualInteraction = () => {
                    if (!isPermanentlyOff.value && viewer.value) {
                        isTemporarilyPaused.value = true;
                        viewer.value.stopOrientation();
                    }
                };

                const handleDeviceMove = () => {
                    if (!isPermanentlyOff.value && isTemporarilyPaused.value && viewer.value) {
                        isTemporarilyPaused.value = false;
                        viewer.value.startOrientation();
                    }
                };

                const handleGyroToggle = () => {
                    if (isPermanentlyOff.value || !viewer.value) return;

                    deactivationClicks.value++;
                    viewer.value.stopOrientation(); // Pastikan gyro berhenti setiap kali diklik

                    if (deactivationClicks.value >= MAX_DEACTIVATION_CLICKS) {
                        isPermanentlyOff.value = true;
                    }
                };

                // --- Lifecycle Hooks ---
                onMounted(() => {
                    viewer.value = pannellum.viewer("panorama-container", {
                        type: "equirectangular",
                        panorama: "image2.jpg",
                        autoLoad: true,
                        autoRotate: -2,
                        showControls: true,
                        compass: true,
                        orientationOnByDefault: true,
                    });

                    const currentViewer = viewer.value;

                    currentViewer.on('load', () => {
                        const supported = currentViewer.isOrientationSupported();
                        isGyroSupported.value = supported;

                        if (supported) {
                            const container = currentViewer.getContainer();
                            // Menggunakan event bubbling (default), bukan capturing
                            container.addEventListener('mousedown', handleManualInteraction);
                            container.addEventListener('touchstart', handleManualInteraction);
                            window.addEventListener('deviceorientation', handleDeviceMove);
                        }
                    });
                });

                onUnmounted(() => {
                    if (viewer.value) {
                        if (isGyroSupported.value) {
                            const container = viewer.value.getContainer();
                            container.removeEventListener('mousedown', handleManualInteraction);
                            container.removeEventListener('touchstart', handleManualInteraction);
                            window.removeEventListener('deviceorientation', handleDeviceMove);
                        }
                        viewer.value.destroy();
                    }
                });

                return {
                    isGyroSupported,
                    isPermanentlyOff,
                    handleGyroToggle,
                    buttonText // Mengirim computed property ke template
                };
            },
            template: `
                <div class="min-h-screen flex flex-col items-center justify-center p-4">
                    <header class="text-center mb-8">
                        <img src="../image/logo.png" alt="Sutan Raya Logo" class="h-16 mx-auto mb-2" />
                        <h1 class="text-3xl font-bold text-[var(--sutan-gold)] tracking-wider">
                            Luxury Travel
                        </h1>
                        <p class="text-gray-400">
                            Rasakan pengalaman mewah armada kami.
                        </p>
                    </header>

                    <div class="w-full max-w-5xl h-[60vh] rounded-lg shadow-2xl overflow-hidden border-2 border-[var(--sutan-gold)]">
                        <div id="panorama-container" class="h-full w-full"></div>
                    </div>

                    <div v-if="isGyroSupported" class="mt-6 text-center">
                        <button 
                            @click="handleGyroToggle" 
                            :disabled="isPermanentlyOff" 
                            :class="{
                                'font-bold py-2 px-6 rounded-lg shadow-lg transition-all duration-300': true,
                                'bg-gray-600 text-gray-400 cursor-not-allowed': isPermanentlyOff,
                                'bg-[var(--sutan-gold)] text-black hover:bg-yellow-300': !isPermanentlyOff
                            }"
                        >
                            {{ buttonText }} </button>
                    </div>

                    <footer class="text-center mt-8 text-gray-500 text-sm">
                        <p>&copy; 2025 PO. Sutan Raya. All rights reserved.</p>
                    </footer>
                </div>
            `
        }).mount('#app');
    </script>
</body>

</html>