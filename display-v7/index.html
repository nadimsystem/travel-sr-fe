<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sutan Raya - Business OS V7.2</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/vue@3/dist/vue.global.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap');
        
        body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: #f3f4f6; }
        
        /* E-Ticket Styles */
        .ticket { background: linear-gradient(135deg, #1e3a8a 0%, #2563eb 100%); border-radius: 1.5rem 1.5rem 0 0; }
        .ticket-cutout { position: relative; background: #fff; border-radius: 0 0 1.5rem 1.5rem; box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1); }
        .ticket-cutout:before, .ticket-cutout:after {
            content: ''; position: absolute; width: 2rem; height: 2rem; border-radius: 50%; top: -1rem; background: #111827;
        }
        .ticket-cutout:before { left: -1rem; } 
        .ticket-cutout:after { right: -1rem; }

        .animate-fade-in { animation: fadeIn 0.4s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        .custom-scrollbar::-webkit-scrollbar { width: 6px; height: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
    </style>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'sutan-blue': { 900: '#0A2342', 800: '#123458', 700: '#2C3E50' },
                        'sutan-gold': '#D4AF37'
                    }
                }
            }
        }
    </script>
</head>

<body class="text-gray-800 h-screen overflow-hidden flex">

    <div id="app" class="flex h-full w-full">

        <aside class="w-72 bg-white border-r border-gray-200 flex flex-col flex-shrink-0 z-20 transition-all duration-300" :class="{ 'hidden': isFullscreen }">
            <div class="h-24 flex items-center justify-center border-b border-gray-200">
                <div class="text-xl font-extrabold text-sutan-blue-900 tracking-tight flex items-center gap-2">
                    <i class="bi bi-building-fill text-sutan-gold"></i> Sutan<span class="text-blue-600">Raya</span> V7.2
                </div>
            </div>

            <nav class="flex-1 overflow-y-auto p-4 custom-scrollbar space-y-1.5">
                <div class="text-[10px] font-bold text-gray-400 uppercase px-4 mb-2 mt-2 tracking-wider">Front Office</div>
                <a href="#" @click="view='dashboard'" :class="view==='dashboard' ? 'bg-sutan-blue-800 text-white shadow-lg shadow-blue-900/20' : 'text-gray-600 hover:bg-gray-50'" class="flex items-center px-4 py-3 rounded-xl font-medium transition-all group">
                    <i class="bi bi-grid-1x2-fill mr-3 group-hover:text-sutan-gold transition-colors"></i> Dashboard
                </a>
                <a href="#" @click="view='booking'" :class="view==='booking' ? 'bg-sutan-blue-800 text-white shadow-lg shadow-blue-900/20' : 'text-gray-600 hover:bg-gray-50'" class="flex items-center px-4 py-3 rounded-xl font-medium transition-all group">
                    <i class="bi bi-ticket-perforated-fill mr-3 group-hover:text-sutan-gold transition-colors"></i> Booking Baru
                </a>
                
                <div class="text-[10px] font-bold text-gray-400 uppercase px-4 mb-2 mt-6 tracking-wider">Operasional</div>
                <a href="#" @click="view='dispatcher'" :class="view==='dispatcher' ? 'bg-sutan-blue-800 text-white shadow-lg shadow-blue-900/20' : 'text-gray-600 hover:bg-gray-50'" class="flex items-center px-4 py-3 rounded-xl font-medium transition-all group">
                    <i class="bi bi-kanban-fill mr-3 group-hover:text-sutan-gold transition-colors"></i> Dispatcher <span v-if="pendingGroupsCount > 0" class="ml-auto bg-orange-500 text-white text-[10px] font-bold px-2 py-0.5 rounded-full">{{ pendingGroupsCount }}</span>
                </a>
                <a href="#" @click="view='manifest'" :class="view==='manifest' ? 'bg-sutan-blue-800 text-white shadow-lg shadow-blue-900/20' : 'text-gray-600 hover:bg-gray-50'" class="flex items-center px-4 py-3 rounded-xl font-medium transition-all group">
                    <i class="bi bi-file-earmark-spreadsheet-fill mr-3 group-hover:text-sutan-gold transition-colors"></i> Laporan Harian
                </a>

                <div class="text-[10px] font-bold text-gray-400 uppercase px-4 mb-2 mt-6 tracking-wider">Aset & Manajemen</div>
                <a href="#" @click="view='assets'" :class="view==='assets' ? 'bg-sutan-blue-800 text-white shadow-lg shadow-blue-900/20' : 'text-gray-600 hover:bg-gray-50'" class="flex items-center px-4 py-3 rounded-xl font-medium transition-all group">
                    <i class="bi bi-collection-fill mr-3 group-hover:text-sutan-gold transition-colors"></i> Armada & Supir
                </a>
            </nav>

            <div class="p-4 border-t border-gray-100 bg-gray-50">
                <button @click="openBookingModal('Online')" class="w-full bg-white border border-gray-200 text-gray-600 hover:text-blue-700 hover:border-blue-300 font-bold py-3 rounded-xl flex items-center justify-center transition-all active:scale-95 text-sm">
                    <i class="bi bi-globe mr-2"></i> Mode Booking Online
                </button>
            </div>
        </aside>

        <main class="flex-1 flex flex-col bg-gray-100 min-w-0 relative h-full">
            
            <header class="bg-white h-20 border-b border-gray-200 flex flex-shrink-0 items-center justify-between px-8 shadow-sm z-10">
                <div>
                    <h1 class="text-xl font-extrabold text-sutan-blue-900">{{ currentViewTitle }}</h1>
                    <p class="text-xs text-gray-500 font-medium">Sistem Operasional Terpadu V7.2</p>
                </div>
                <div class="flex items-center gap-6">
                    <div class="text-right hidden md:block">
                        <div class="text-xs text-gray-500 font-bold uppercase tracking-wider">{{ currentDate }}</div>
                        <div class="text-xl font-bold text-sutan-blue-900 font-mono">{{ currentTime }}</div>
                    </div>
                    <button @click="toggleFullscreen" class="w-10 h-10 rounded-full bg-gray-50 hover:bg-blue-50 text-gray-500 hover:text-blue-700 transition-all flex items-center justify-center"><i :class="isFullscreen ? 'bi-arrows-angle-contract' : 'bi-arrows-fullscreen'"></i></button>
                </div>
            </header>

            <div class="flex-1 overflow-y-auto p-6 custom-scrollbar scroll-smooth">
                
                <div v-if="view === 'dashboard'" class="space-y-6 animate-fade-in">
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-5">
                        <div class="bg-white p-5 rounded-2xl shadow-sm border border-gray-100 flex justify-between items-center hover:shadow-md transition-all">
                            <div><div class="text-xs text-gray-400 font-bold uppercase tracking-wider">Pendapatan Hari Ini</div><div class="text-2xl font-extrabold text-gray-800 mt-1">{{ formatRupiah(todayRevenue) }}</div></div>
                            <div class="w-12 h-12 rounded-xl bg-green-50 text-green-600 flex items-center justify-center text-2xl"><i class="bi bi-cash-stack"></i></div>
                        </div>
                        <div class="bg-white p-5 rounded-2xl shadow-sm border border-gray-100 flex justify-between items-center hover:shadow-md transition-all">
                            <div><div class="text-xs text-gray-400 font-bold uppercase tracking-wider">Total Penumpang</div><div class="text-2xl font-extrabold text-gray-800 mt-1">{{ todayPax }} <span class="text-xs font-normal text-gray-400">Pax</span></div></div>
                            <div class="w-12 h-12 rounded-xl bg-blue-50 text-blue-600 flex items-center justify-center text-2xl"><i class="bi bi-people-fill"></i></div>
                        </div>
                        <div class="bg-white p-5 rounded-2xl shadow-sm border border-gray-100 flex justify-between items-center hover:shadow-md transition-all">
                            <div><div class="text-xs text-gray-400 font-bold uppercase tracking-wider">Menunggu Validasi</div><div class="text-2xl font-extrabold text-red-500 mt-1">{{ pendingValidationCount }} <span class="text-xs font-normal text-gray-400">Tiket</span></div></div>
                            <div class="w-12 h-12 rounded-xl bg-red-50 text-red-600 flex items-center justify-center text-2xl"><i class="bi bi-exclamation-circle-fill"></i></div>
                        </div>
                        <div class="bg-white p-5 rounded-2xl shadow-sm border border-gray-100 flex justify-between items-center hover:shadow-md transition-all">
                            <div><div class="text-xs text-gray-400 font-bold uppercase tracking-wider">Antrian Dispatch</div><div class="text-2xl font-extrabold text-orange-500 mt-1">{{ pendingGroupsCount }} <span class="text-xs font-normal text-gray-400">Grup</span></div></div>
                            <div class="w-12 h-12 rounded-xl bg-orange-50 text-orange-600 flex items-center justify-center text-2xl"><i class="bi bi-clock-history"></i></div>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 h-full">
                        <div class="lg:col-span-2 bg-white rounded-2xl shadow-sm border border-gray-200 p-6 h-full flex flex-col">
                            <h3 class="font-bold text-gray-800 mb-4 flex items-center"><i class="bi bi-broadcast text-green-500 mr-2 animate-pulse"></i> Operasional Berjalan</h3>
                            <div class="flex-1 overflow-y-auto custom-scrollbar space-y-3 pr-2">
                                <div v-if="activeTrips.length === 0" class="h-40 flex flex-col items-center justify-center text-gray-400 border-2 border-dashed border-gray-100 rounded-xl">
                                    <i class="bi bi-emoji-coffee text-3xl mb-2"></i>
                                    <span class="text-sm">Belum ada armada yang berangkat.</span>
                                </div>
                                <div v-for="trip in activeTrips" :key="trip.id" class="p-4 rounded-xl border border-gray-100 bg-gray-50/50 hover:bg-blue-50/30 transition-colors flex justify-between items-center">
                                    <div class="flex items-center gap-4">
                                        <div class="text-center w-14">
                                            <div class="text-xl font-bold text-gray-900">{{ trip.routeConfig.time }}</div>
                                            <div class="text-[10px] font-bold text-gray-400 uppercase">{{ trip.routeConfig.routeId }}</div>
                                        </div>
                                        <div class="h-8 w-px bg-gray-200"></div>
                                        <div>
                                            <div class="font-bold text-sutan-blue-900 flex items-center gap-2">
                                                {{ trip.fleet.name }}
                                                <span class="px-2 py-0.5 bg-white border border-gray-200 rounded text-[10px] font-mono text-gray-500">{{ trip.fleet.plate }}</span>
                                            </div>
                                            <div class="text-xs text-gray-500 mt-0.5"><i class="bi bi-person-steering-wheel mr-1"></i> {{ trip.driver.name }} • <strong>{{ trip.passengers.length }}</strong> Penumpang</div>
                                        </div>
                                    </div>
                                    <button @click="completeTrip(trip)" class="px-4 py-2 bg-green-600 text-white rounded-lg text-xs font-bold hover:bg-green-700 transition-all shadow-sm active:scale-95">Tiba di Tujuan</button>
                                </div>
                            </div>
                        </div>

                        <div class="bg-white rounded-2xl shadow-sm border border-gray-200 p-6">
                            <h3 class="font-bold text-gray-800 mb-4 flex items-center"><i class="bi bi-p-circle text-blue-500 mr-2"></i> Status Armada</h3>
                            <div class="space-y-3 max-h-[400px] overflow-y-auto custom-scrollbar pr-1">
                                <div v-for="f in fleet" :key="f.id" class="flex items-center justify-between p-2.5 rounded-lg border transition-all" :class="getVehicleStatusClass(f.status)">
                                    <div class="flex items-center gap-3">
                                        <i :class="f.icon" class="text-xl"></i>
                                        <div>
                                            <div class="text-xs font-bold">{{ f.name }}</div>
                                            <div class="text-[10px] opacity-70">{{ f.plate }}</div>
                                        </div>
                                    </div>
                                    <div class="text-[10px] font-bold px-2 py-1 rounded-md bg-white/50 uppercase">{{ f.status }}</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div v-if="view === 'dispatcher'" class="animate-fade-in h-full flex flex-col">
                    <div class="flex justify-between items-end mb-6">
                        <div>
                            <h2 class="text-lg font-bold text-gray-800">Dispatcher Console</h2>
                            <p class="text-sm text-gray-500">Validasi pembayaran dan berangkatkan armada.</p>
                        </div>
                        <div class="text-right">
                            <div class="text-sm font-bold text-orange-600 bg-orange-50 px-3 py-1 rounded-lg">{{ pendingGroupsCount }} Grup Menunggu</div>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6 overflow-y-auto pb-4">
                        <div v-if="groupedBookings.length === 0" class="col-span-full flex flex-col items-center justify-center h-64 text-gray-400 border-2 border-dashed border-gray-200 rounded-3xl bg-gray-50">
                            <i class="bi bi-check-all text-5xl mb-3 text-green-400"></i>
                            <p class="font-medium">Semua penumpang telah diberangkatkan!</p>
                        </div>

                        <div v-for="group in groupedBookings" :key="group.key" class="bg-white rounded-2xl shadow-sm border border-gray-200 flex flex-col overflow-hidden group hover:shadow-md transition-all h-[500px]">
                            <div class="p-5 border-b border-gray-100 bg-gray-50/30 relative">
                                <div class="absolute top-0 left-0 bottom-0 w-1.5 bg-orange-500"></div>
                                <div class="flex justify-between items-start mb-2">
                                    <span class="bg-white border border-gray-200 text-gray-600 text-[10px] font-bold px-2 py-1 rounded uppercase tracking-wider">{{ group.routeConfig?.id || group.routeId }}</span>
                                    <span class="text-xs font-bold text-orange-600 flex items-center gap-1"><i class="bi bi-clock"></i> {{ group.time }}</span>
                                </div>
                                <div class="flex items-center gap-2 text-sm font-bold text-gray-800">
                                    <span>{{ group.routeOrigin }}</span> <i class="bi bi-arrow-right text-gray-400 text-xs"></i> <span>{{ group.routeDest }}</span>
                                </div>
                                <div class="text-[10px] text-gray-400 mt-1 uppercase font-semibold">{{ formatDate(group.date) }}</div>
                            </div>

                            <div class="flex-1 overflow-y-auto p-2 custom-scrollbar bg-white space-y-1">
                                <div v-for="p in group.passengers" class="p-3 rounded-lg border border-gray-100 hover:bg-blue-50 hover:border-blue-100 transition-all group/item">
                                    <div class="flex justify-between items-start">
                                        <div>
                                            <div class="font-bold text-xs text-gray-800 flex items-center gap-1">
                                                {{ p.passengerName }}
                                                <span v-if="p.serviceType === 'Dropping'" class="bg-purple-100 text-purple-700 px-1.5 rounded-[4px] text-[9px] font-bold">CHARTER</span>
                                                <span v-else class="bg-gray-100 text-gray-600 px-1.5 rounded-[4px] text-[9px] font-mono">{{ p.seatNumbers }}</span>
                                            </div>
                                            <div class="text-[10px] text-gray-500 mt-0.5"><i class="bi bi-telephone"></i> {{ p.passengerPhone }}</div>
                                            <div v-if="p.passengerType === 'Pelajar'" class="text-[9px] text-blue-600 font-bold mt-1 flex items-center gap-1">
                                                <i class="bi bi-person-vcard-fill"></i> Pelajar 
                                                <span v-if="p.ktmProof" class="text-green-600"><i class="bi bi-check"></i></span>
                                            </div>
                                        </div>
                                        <div class="text-right flex flex-col items-end gap-1">
                                            <div v-if="p.validationStatus !== 'Valid'">
                                                <button @click="validatePaymentModal(p)" class="text-[9px] bg-red-100 hover:bg-red-200 text-red-700 px-2 py-1 rounded font-bold transition-colors flex items-center gap-1 animate-pulse">
                                                    Validasi <i class="bi bi-chevron-right"></i>
                                                </button>
                                            </div>
                                            <div v-else class="text-[9px] bg-green-100 text-green-700 px-2 py-1 rounded font-bold flex items-center gap-1">
                                                <i class="bi bi-check-lg"></i> Lunas
                                            </div>
                                            <div class="text-[9px] text-gray-400">{{ p.paymentMethod }}</div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="p-4 border-t border-gray-100 bg-gray-50 flex justify-between items-center">
                                <div>
                                    <div class="text-[10px] text-gray-400 font-bold uppercase">Total Muatan</div>
                                    <div class="text-lg font-extrabold text-gray-800">{{ group.totalPassengers }} <span class="text-xs font-medium text-gray-500">Kursi</span></div>
                                </div>
                                <button @click="openDispatchModal(group)" class="bg-sutan-blue-900 hover:bg-sutan-blue-800 text-white text-xs font-bold px-4 py-2.5 rounded-xl shadow-lg shadow-blue-900/20 transition-all active:scale-95 flex items-center gap-2">
                                    <i class="bi bi-send-fill"></i> Dispatch
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <div v-if="view === 'booking'" class="animate-fade-in flex justify-center">
                    <div class="w-full max-w-5xl bg-white rounded-3xl shadow-xl border border-gray-200 overflow-hidden flex flex-col md:flex-row h-[85vh]">
                        
                        <div class="w-full md:w-7/12 p-8 overflow-y-auto custom-scrollbar">
                            <div class="mb-6 border-b border-gray-100 pb-4">
                                <h2 class="text-2xl font-extrabold text-sutan-blue-900">Booking Perjalanan</h2>
                                <p class="text-sm text-gray-500">Detail Penumpang & Layanan</p>
                            </div>

                            <div class="space-y-5">
                                <div class="grid grid-cols-2 gap-4">
                                    <div class="col-span-2">
                                        <label class="text-xs font-bold text-gray-400 uppercase mb-1 block">Rute</label>
                                        <select v-model="bookingForm.data.routeId" @change="calculatePrice" class="w-full p-3 bg-gray-50 border border-gray-200 rounded-xl font-semibold text-gray-800 focus:ring-2 focus:ring-blue-500 outline-none">
                                            <option value="" disabled>Pilih Rute</option>
                                            <option v-for="r in routeConfig" :value="r.id">{{ r.origin }} ⇄ {{ r.destination }}</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="text-xs font-bold text-gray-400 uppercase mb-1 block">Tanggal</label>
                                        <input type="date" v-model="bookingForm.data.date" @change="resetSeatSelection" class="w-full p-3 bg-gray-50 border border-gray-200 rounded-xl font-semibold text-gray-800 focus:ring-2 focus:ring-blue-500 outline-none">
                                    </div>
                                    <div>
                                        <label class="text-xs font-bold text-gray-400 uppercase mb-1 block">Jam</label>
                                        <select v-if="bookingForm.data.serviceType !== 'Dropping'" v-model="bookingForm.data.time" @change="resetSeatSelection" class="w-full p-3 bg-gray-50 border border-gray-200 rounded-xl font-semibold text-gray-800 focus:ring-2 focus:ring-blue-500 outline-none">
                                            <option value="" disabled>Pilih Jam</option>
                                            <option v-for="t in selectedRoute?.schedules" :value="t">{{ t }}</option>
                                        </select>
                                        <input v-else type="time" v-model="bookingForm.data.time" class="w-full p-3 bg-blue-50 border border-blue-200 text-blue-800 rounded-xl font-bold focus:ring-2 focus:ring-blue-500 outline-none">
                                    </div>
                                </div>

                                <div v-if="bookingForm.data.routeId" class="flex p-1 bg-gray-100 rounded-xl">
                                    <button @click="setServiceType('Travel')" class="flex-1 py-2 rounded-lg text-xs font-bold transition-all" :class="bookingForm.data.serviceType==='Travel'?'bg-white shadow-sm text-blue-700':'text-gray-500'">Reguler</button>
                                    <button @click="setServiceType('Dropping')" class="flex-1 py-2 rounded-lg text-xs font-bold transition-all" :class="bookingForm.data.serviceType==='Dropping'?'bg-white shadow-sm text-blue-700':'text-gray-500'">Charter</button>
                                </div>

                                <div v-if="bookingForm.data.routeId" class="space-y-4">
                                    <div class="grid grid-cols-2 gap-4">
                                        <div><label class="text-xs font-bold text-gray-400 uppercase mb-1 block">Nama</label><input type="text" v-model="bookingForm.data.passengerName" class="w-full p-3 border border-gray-200 rounded-xl text-sm focus:border-blue-500 outline-none"></div>
                                        <div><label class="text-xs font-bold text-gray-400 uppercase mb-1 block">WhatsApp</label><input type="text" v-model="bookingForm.data.passengerPhone" class="w-full p-3 border border-gray-200 rounded-xl text-sm focus:border-blue-500 outline-none"></div>
                                    </div>
                                    
                                    <div v-if="bookingForm.data.serviceType==='Travel'" class="flex gap-4">
                                        <label class="flex items-center gap-2 p-3 border border-gray-200 rounded-xl cursor-pointer flex-1 hover:bg-gray-50">
                                            <input type="radio" value="Umum" v-model="bookingForm.data.passengerType" @change="calculatePrice" class="text-blue-600">
                                            <span class="text-sm font-bold text-gray-700">Umum</span>
                                        </label>
                                        <label class="flex items-center gap-2 p-3 border border-gray-200 rounded-xl cursor-pointer flex-1 hover:bg-gray-50">
                                            <input type="radio" value="Pelajar" v-model="bookingForm.data.passengerType" @change="calculatePrice" class="text-blue-600">
                                            <span class="text-sm font-bold text-gray-700">Pelajar</span>
                                        </label>
                                    </div>

                                    <div v-if="bookingForm.data.passengerType === 'Pelajar'" class="p-4 bg-yellow-50 border border-yellow-200 rounded-xl animate-fade-in">
                                        <label class="text-xs font-bold text-yellow-700 uppercase mb-2 block flex items-center"><i class="bi bi-person-vcard mr-2"></i> Upload KTM / Kartu Pelajar (Wajib)</label>
                                        <div class="flex items-center gap-3">
                                            <label class="cursor-pointer bg-white border border-yellow-300 text-yellow-700 px-4 py-2 rounded-lg text-xs font-bold hover:bg-yellow-100 transition-colors shadow-sm flex items-center gap-2">
                                                <i class="bi bi-upload"></i> Pilih File
                                                <input type="file" accept="image/*" @change="handleKTMUpload" class="hidden">
                                            </label>
                                            <span v-if="bookingForm.data.ktmProof" class="text-xs text-green-600 font-bold truncate flex items-center"><i class="bi bi-check-circle-fill mr-1"></i> {{ bookingForm.data.ktmProof }}</span>
                                            <span v-else class="text-xs text-gray-400 italic">Belum ada file dipilih</span>
                                        </div>
                                    </div>

                                    <div class="grid grid-cols-2 gap-4">
                                        <input type="text" v-model="bookingForm.data.pickupAddress" placeholder="Alamat Jemput" class="w-full p-3 border border-gray-200 rounded-xl text-sm">
                                        <input type="text" v-model="bookingForm.data.dropoffAddress" placeholder="Alamat Antar" class="w-full p-3 border border-gray-200 rounded-xl text-sm">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="w-full md:w-5/12 bg-gray-50 border-l border-gray-200 flex flex-col">
                            <div class="flex-1 p-6 overflow-y-auto custom-scrollbar">
                                <div class="flex justify-center mb-6">
                                    <div v-if="bookingForm.data.routeId && bookingForm.data.serviceType === 'Travel'" class="bg-white border-2 border-gray-200 rounded-[2rem] p-5 shadow-sm relative w-[200px]">
                                        <div class="absolute top-0 left-1/2 -translate-x-1/2 w-16 h-1 bg-gray-200 rounded-b-lg"></div>
                                        <div class="space-y-3 mt-2">
                                            <div v-for="row in seatLayout" :key="row.row">
                                                <div class="text-[8px] text-gray-300 text-center uppercase tracking-widest mb-1">{{ row.label }}</div>
                                                <div class="flex justify-between gap-2">
                                                    <div v-for="seat in row.seats" :key="seat.id" class="flex-1 flex justify-center">
                                                        <div v-if="seat.type==='driver'" class="w-9 h-9 bg-gray-100 rounded-lg flex items-center justify-center text-gray-300"><i class="bi bi-person-fill"></i></div>
                                                        <button v-else @click="toggleSeat(seat.id)" :disabled="isSeatOccupied(seat.id)" class="w-9 h-9 rounded-lg font-bold text-xs border transition-all relative" :class="[isSeatOccupied(seat.id) ? 'bg-gray-800 text-white cursor-not-allowed border-gray-800' : (isSeatSelected(seat.id) ? 'bg-sutan-blue-900 text-white border-sutan-blue-900 shadow-md scale-105' : 'bg-white hover:bg-yellow-50 text-gray-600 border-gray-200')]">{{ seat.id }}</button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div v-else-if="bookingForm.data.serviceType === 'Dropping'" class="text-center p-8">
                                        <div class="w-20 h-20 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center text-3xl mx-auto mb-4"><i class="bi bi-car-front-fill"></i></div>
                                        <h3 class="font-bold text-gray-800">Full Charter</h3>
                                        <p class="text-xs text-gray-500 mt-1">Satu unit armada diblokir.</p>
                                    </div>
                                </div>

                                <div v-if="bookingForm.data.routeId" class="bg-white p-4 rounded-xl border border-gray-200 shadow-sm space-y-4">
                                    <h4 class="text-xs font-bold text-gray-400 uppercase border-b pb-2">Pembayaran</h4>
                                    <div class="flex gap-2">
                                        <label class="flex-1 cursor-pointer text-center">
                                            <input type="radio" value="Cash" v-model="bookingForm.data.paymentMethod" class="hidden peer">
                                            <div class="py-2 rounded-lg text-xs font-bold border border-gray-200 text-gray-500 peer-checked:bg-blue-50 peer-checked:text-blue-700 peer-checked:border-blue-200 transition-all flex items-center justify-center gap-1"><i class="bi bi-cash"></i> Cash</div>
                                        </label>
                                        <label class="flex-1 cursor-pointer text-center">
                                            <input type="radio" value="Transfer" v-model="bookingForm.data.paymentMethod" class="hidden peer">
                                            <div class="py-2 rounded-lg text-xs font-bold border border-gray-200 text-gray-500 peer-checked:bg-blue-50 peer-checked:text-blue-700 peer-checked:border-blue-200 transition-all flex items-center justify-center gap-1"><i class="bi bi-bank"></i> Transfer</div>
                                        </label>
                                    </div>

                                    <div v-if="bookingForm.data.paymentMethod === 'Cash'" class="space-y-3 animate-fade-in">
                                        <div>
                                            <label class="text-[10px] font-bold text-gray-400 uppercase mb-1 block">Lokasi Pembayaran</label>
                                            <input type="text" v-model="bookingForm.data.paymentLocation" placeholder="Contoh: Loket / Di Mobil" class="w-full p-2 border border-gray-200 rounded-lg text-xs">
                                        </div>
                                        <div>
                                            <label class="text-[10px] font-bold text-gray-400 uppercase mb-1 block">Diterima Oleh</label>
                                            <input type="text" v-model="bookingForm.data.paymentReceiver" placeholder="Nama Staf / Supir" class="w-full p-2 border border-gray-200 rounded-lg text-xs">
                                        </div>
                                    </div>

                                    <div v-else class="space-y-3 animate-fade-in">
                                        <div class="text-xs text-center bg-gray-50 p-2 rounded text-gray-600 font-mono">BCA: 123456789 (Sutan Raya)</div>
                                        <label class="block w-full text-xs text-center border-2 border-dashed border-gray-300 rounded-lg p-4 cursor-pointer hover:bg-gray-50 transition-colors">
                                            <span v-if="!bookingForm.data.paymentProof" class="text-gray-400"><i class="bi bi-cloud-upload text-xl block mb-1"></i>Upload Bukti Transfer</span>
                                            <span v-else class="text-green-600 font-bold flex flex-col items-center"><i class="bi bi-check-circle-fill text-xl mb-1"></i> {{ bookingForm.data.paymentProof }}</span>
                                            <input type="file" accept="image/*" @change="handlePaymentProofUpload" class="hidden">
                                        </label>
                                    </div>
                                </div>
                            </div>

                            <div class="p-6 bg-white border-t border-gray-200">
                                <div class="flex justify-between items-end mb-4">
                                    <div class="text-xs text-gray-500 font-bold uppercase">Total Biaya</div>
                                    <div class="text-2xl font-extrabold text-sutan-blue-900">{{ formatRupiah(bookingForm.data.totalPrice) }}</div>
                                </div>
                                <button @click="saveBooking" :disabled="!bookingForm.data.routeId || bookingForm.data.totalPrice === 0" class="w-full py-3 bg-sutan-blue-900 hover:bg-sutan-blue-800 disabled:bg-gray-300 disabled:cursor-not-allowed text-white font-bold rounded-xl shadow-lg shadow-blue-900/20 transition-all active:scale-95">
                                    Proses Booking
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <div v-if="view === 'manifest'" class="animate-fade-in">
                    <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-200">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-lg font-bold text-gray-800">Laporan Harian</h2>
                            <input type="date" v-model="reportDate" class="p-2 border border-gray-200 rounded-lg text-sm font-bold text-gray-600 outline-none">
                        </div>
                        <div class="space-y-8">
                            <div v-for="(data, routeId) in dailyReportData" :key="routeId" class="border border-gray-200 rounded-xl overflow-hidden">
                                <div class="bg-gray-50 p-4 border-b border-gray-200 flex justify-between items-center">
                                    <div class="font-bold text-sutan-blue-900 flex items-center gap-2"><span class="bg-blue-100 text-blue-800 px-2 py-0.5 rounded text-xs font-mono border border-blue-200">{{ routeId }}</span> {{ data.route.origin }} ⇄ {{ data.route.destination }}</div>
                                    <div class="text-xs text-gray-500 font-bold uppercase">Total Pax: {{ data.total.totalPax }}</div>
                                </div>
                                <div class="overflow-x-auto">
                                    <table class="w-full text-sm text-left">
                                        <thead class="text-xs text-gray-500 uppercase bg-white border-b border-gray-100"><tr><th class="px-4 py-3">Jam</th><th class="px-4 py-3 text-center bg-blue-50/50">Umum</th><th class="px-4 py-3 text-center bg-green-50/50">Pelajar</th><th class="px-4 py-3 text-right">Total</th></tr></thead>
                                        <tbody class="divide-y divide-gray-50">
                                            <tr v-for="row in data.schedules" :key="row.time" class="hover:bg-gray-50">
                                                <td class="px-4 py-3 font-mono font-bold text-gray-700">{{ row.time }}</td>
                                                <td class="px-4 py-3 text-center bg-blue-50/30"><div v-if="row.umumPax > 0"><span class="font-bold">{{ row.umumPax }}</span> <span class="text-[10px] text-gray-400">Pax</span> <div class="text-[10px] text-blue-600 font-bold">{{ formatRupiah(row.umumNom) }}</div></div><span v-else class="text-gray-300">-</span></td>
                                                <td class="px-4 py-3 text-center bg-green-50/30"><div v-if="row.pelajarPax > 0"><span class="font-bold">{{ row.pelajarPax }}</span> <span class="text-[10px] text-gray-400">Pax</span> <div class="text-[10px] text-green-600 font-bold">{{ formatRupiah(row.pelajarNom) }}</div></div><span v-else class="text-gray-300">-</span></td>
                                                <td class="px-4 py-3 text-right font-bold text-gray-800">{{ formatRupiah(row.totalNom) }}</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div v-if="view === 'assets'" class="grid grid-cols-1 lg:grid-cols-2 gap-6 animate-fade-in">
                    <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-200">
                        <div class="flex justify-between items-center mb-4"><h2 class="font-bold text-gray-800"><i class="bi bi-truck-front-fill mr-2 text-blue-600"></i>Data Armada</h2><button @click="openVehicleModal(null)" class="text-xs bg-gray-100 hover:bg-blue-100 text-blue-600 font-bold px-3 py-1.5 rounded-lg transition-colors">+ Tambah</button></div>
                        <div class="space-y-3 max-h-[500px] overflow-y-auto custom-scrollbar pr-1">
                            <div v-for="v in fleet" :key="v.id" class="flex justify-between items-center p-3 border rounded-xl hover:shadow-sm transition-all bg-white"><div class="flex items-center gap-3"><div class="w-10 h-10 rounded-lg bg-gray-50 flex items-center justify-center text-gray-400"><i :class="v.icon"></i></div><div><div class="font-bold text-sm text-gray-800">{{ v.name }}</div><div class="text-[10px] font-mono text-gray-500 bg-gray-100 px-1.5 py-0.5 rounded inline-block">{{ v.plate }}</div></div></div><div class="text-right"><div class="text-[10px] font-bold px-2 py-1 rounded uppercase mb-1" :class="getVehicleStatusClass(v.status)">{{ v.status }}</div><button @click="openVehicleModal(v)" class="text-[10px] text-blue-600 font-bold hover:underline">Edit</button></div></div>
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-200">
                        <div class="flex justify-between items-center mb-4"><h2 class="font-bold text-gray-800"><i class="bi bi-person-badge-fill mr-2 text-green-600"></i>Data Supir</h2><button @click="openDriverModal(null)" class="text-xs bg-gray-100 hover:bg-green-100 text-green-600 font-bold px-3 py-1.5 rounded-lg transition-colors">+ Tambah</button></div>
                        <div class="space-y-3 max-h-[500px] overflow-y-auto custom-scrollbar pr-1">
                            <div v-for="d in drivers" :key="d.id" class="flex justify-between items-center p-3 border rounded-xl hover:shadow-sm transition-all bg-white"><div class="flex items-center gap-3"><div class="w-10 h-10 rounded-full bg-gray-50 flex items-center justify-center text-gray-400"><i class="bi bi-person-fill"></i></div><div><div class="font-bold text-sm text-gray-800">{{ d.name }}</div><div class="text-[10px] text-gray-500">{{ d.phone }}</div></div></div><div class="text-right"><div class="text-[10px] font-bold px-2 py-1 rounded uppercase mb-1" :class="getDriverStatusClass(d.status)">{{ d.status }}</div><button @click="openDriverModal(d)" class="text-[10px] text-blue-600 font-bold hover:underline">Edit</button></div></div>
                        </div>
                    </div>
                </div>

            </div>
        </main>

        <div v-if="isProofModalVisible" class="fixed inset-0 bg-black/95 z-50 flex items-center justify-center p-4 backdrop-blur-sm" @click.self="isProofModalVisible=false">
            <div class="bg-white p-6 rounded-2xl text-center max-w-lg w-full shadow-2xl animate-fade-in">
                <h3 class="text-xl font-bold text-gray-800 mb-1">Validasi Pembayaran</h3>
                <p class="text-sm text-gray-500 mb-4">Metode: <span class="font-bold text-sutan-blue-900 uppercase">{{ validationData.paymentMethod }}</span></p>
                
                <div v-if="validationData.paymentMethod === 'Cash'" class="bg-gray-50 p-6 rounded-xl border border-gray-200 mb-6 text-left space-y-3">
                    <div class="flex justify-between"><span class="text-gray-500 text-sm">Lokasi Bayar:</span> <span class="font-bold text-gray-800">{{ validationData.paymentLocation || '-' }}</span></div>
                    <div class="flex justify-between"><span class="text-gray-500 text-sm">Diterima Oleh:</span> <span class="font-bold text-gray-800">{{ validationData.paymentReceiver || '-' }}</span></div>
                    <div class="flex justify-between border-t border-gray-200 pt-2 mt-2"><span class="text-gray-500 text-sm">Nominal:</span> <span class="font-bold text-blue-600 text-lg">{{ formatRupiah(validationData.totalPrice) }}</span></div>
                </div>

                <div v-else class="relative bg-gray-100 h-[300px] w-full rounded-xl flex items-center justify-center text-gray-500 overflow-hidden border border-gray-200 mb-6">
                    <span v-if="!validationData.paymentProof" class="text-gray-400 flex flex-col items-center"><i class="bi bi-image-alt text-4xl mb-2"></i>Tidak ada bukti upload</span>
                    <img v-else :src="validationData.paymentProofUrl || 'placeholder.jpg'" class="object-contain w-full h-full"> 
                    <div v-if="validationData.paymentProof" class="absolute bottom-2 left-2 bg-black/50 text-white px-2 py-1 rounded text-xs">{{ validationData.paymentProof }}</div>
                </div>

                <div v-if="validationData.passengerType === 'Pelajar'" class="mb-6">
                    <h4 class="text-xs font-bold text-gray-400 uppercase mb-2">Bukti Mahasiswa/Pelajar</h4>
                    <div class="bg-yellow-50 border border-yellow-200 p-3 rounded-lg flex items-center justify-center text-yellow-700 text-sm font-bold gap-2">
                        <i class="bi bi-person-vcard"></i> {{ validationData.ktmProof || 'Tidak ada KTM' }}
                    </div>
                </div>
                
                <div class="flex gap-3">
                    <button @click="isProofModalVisible=false" class="flex-1 py-3 rounded-xl bg-gray-100 font-bold text-gray-600 hover:bg-gray-200 transition-colors">Tutup</button>
                    <button @click="confirmValidation(validationData)" class="flex-1 py-3 rounded-xl bg-green-600 text-white font-bold hover:bg-green-700 shadow-lg shadow-green-200 transition-transform active:scale-95 flex items-center justify-center gap-2"><i class="bi bi-check-lg"></i> Validasi Lunas</button>
                </div>
            </div>
        </div>

        <div v-if="isDispatchModalVisible" class="fixed inset-0 bg-gray-900/80 z-50 flex items-center justify-center p-4 backdrop-blur-sm">
            <div class="bg-white w-full max-w-md rounded-2xl shadow-2xl p-6 animate-fade-in">
                <div class="text-center mb-6"><div class="w-14 h-14 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mx-auto mb-3 text-2xl"><i class="bi bi-steering-wheel"></i></div><h3 class="text-xl font-bold text-gray-900">Berangkatkan Armada</h3><p class="text-sm text-gray-500 mt-1">Pilih unit dan supir untuk jadwal ini.</p></div>
                <div class="space-y-4">
                    <div><label class="text-xs font-bold text-gray-500 uppercase mb-1 block">Armada</label><select v-model="dispatchForm.fleetId" class="w-full border-gray-200 p-3 rounded-xl bg-white outline-none font-semibold text-gray-700"><option value="" disabled>-- Pilih Mobil --</option><option v-for="f in fleet.filter(x=>x.status==='Tersedia')" :value="f.id">{{ f.name }} ({{f.plate}})</option></select></div>
                    <div><label class="text-xs font-bold text-gray-500 uppercase mb-1 block">Supir</label><select v-model="dispatchForm.driverId" class="w-full border-gray-200 p-3 rounded-xl bg-white outline-none font-semibold text-gray-700"><option value="" disabled>-- Pilih Supir --</option><option v-for="d in drivers.filter(x=>x.status==='Standby')" :value="d.id">{{ d.name }}</option></select></div>
                </div>
                <div class="mt-8 flex gap-3"><button @click="isDispatchModalVisible=false" class="flex-1 bg-white border border-gray-200 hover:bg-gray-50 text-gray-600 py-3 rounded-xl font-bold transition-colors">Batal</button><button @click="processDispatch" class="flex-1 bg-sutan-blue-900 hover:bg-sutan-blue-800 text-white py-3 rounded-xl font-bold shadow-lg shadow-blue-900/20 transition-transform active:scale-95">Proses</button></div>
            </div>
        </div>

        <div v-if="isTicketModalVisible" class="fixed inset-0 bg-black/90 z-50 flex items-center justify-center p-4 backdrop-blur-sm" @click.self="isTicketModalVisible=false">
            <div class="w-full max-w-sm transform transition-all scale-100 animate-fade-in">
                <div class="ticket p-8 text-white relative overflow-hidden"><div class="flex justify-between items-start mb-8 relative z-10"><div><div class="text-3xl font-bold tracking-tight">Sutan<span class="font-light">Raya</span></div><div class="text-[10px] opacity-80 uppercase tracking-widest mt-1 font-bold">Boarding Pass</div></div><div class="text-right"><div class="text-[10px] opacity-60 uppercase font-bold">Booking ID</div><div class="font-mono text-lg font-bold">#{{ ticketData.id.toString().slice(-6) }}</div></div></div><div class="flex justify-between items-end relative z-10"><div><div class="text-[10px] opacity-60 uppercase font-bold mb-1">Nama Penumpang</div><div class="text-xl font-bold truncate max-w-[160px]">{{ ticketData.passengerName }}</div></div><div class="text-right"><div class="text-[10px] opacity-60 uppercase font-bold mb-1">Jam</div><div class="text-xl font-bold">{{ ticketData.time }}</div></div></div></div>
                <div class="ticket-cutout bg-white p-8 pt-10">
                    <div class="flex justify-between mb-5 border-b border-dashed border-gray-200 pb-5"><div><div class="text-xs text-gray-400 uppercase font-bold">Rute</div><div class="font-bold text-gray-800 text-sm">{{ getRouteName(ticketData.routeId) }}</div></div><div class="text-right"><div class="text-xs text-gray-400 uppercase font-bold">Tanggal</div><div class="font-bold text-gray-800 text-sm">{{ formatDate(ticketData.date) }}</div></div></div>
                    <button class="w-full py-3 rounded-xl border-2 border-gray-100 text-gray-500 font-bold text-sm hover:bg-gray-50 transition-colors flex items-center justify-center gap-2"><i class="bi bi-printer"></i> Cetak / Download</button>
                </div>
            </div>
        </div>

        <div v-if="isVehicleModalVisible" class="fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-4 backdrop-blur-sm"><div class="bg-white rounded-2xl shadow-2xl w-full max-w-lg p-6 animate-fade-in"><h3 class="text-xl font-bold text-gray-900 mb-4">{{ vehicleModal.mode === 'add' ? 'Tambah Unit Baru' : 'Edit Data Unit' }}</h3><div class="space-y-4"><input type="text" v-model="vehicleModal.data.name" placeholder="Nama Armada (Contoh: Hiace 01)" class="w-full border p-3 rounded-xl"><input type="text" v-model="vehicleModal.data.plate" placeholder="Plat Nomor" class="w-full border p-3 rounded-xl"><div class="grid grid-cols-2 gap-4"><select v-model="vehicleModal.data.type" class="w-full border p-3 rounded-xl bg-white"><option>Hiace Premio</option><option>Hiace Commuter</option><option>Medium Bus</option><option>Big Bus</option></select><input type="number" v-model.number="vehicleModal.data.capacity" placeholder="Kapasitas Seat" class="w-full border p-3 rounded-xl"></div><select v-model="vehicleModal.data.status" class="w-full border p-3 rounded-xl bg-white"><option>Tersedia</option><option>Perbaikan</option></select></div><div class="mt-6 flex justify-end gap-3"><button @click="closeVehicleModal" class="px-4 py-2 text-gray-500 font-bold hover:bg-gray-100 rounded-lg">Batal</button><button @click="saveVehicle" class="px-6 py-2 bg-blue-600 text-white rounded-xl font-bold hover:bg-blue-700">Simpan Data</button></div></div></div>
        <div v-if="isDriverModalVisible" class="fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-4 backdrop-blur-sm"><div class="bg-white rounded-2xl shadow-2xl w-full max-w-lg p-6 animate-fade-in"><h3 class="text-xl font-bold text-gray-900 mb-4">{{ driverModal.mode === 'add' ? 'Tambah Supir Baru' : 'Edit Data Supir' }}</h3><div class="space-y-4"><input type="text" v-model="driverModal.data.name" placeholder="Nama Lengkap" class="w-full border p-3 rounded-xl"><input type="text" v-model="driverModal.data.phone" placeholder="Nomor Telepon" class="w-full border p-3 rounded-xl"><div class="grid grid-cols-2 gap-4"><select v-model="driverModal.data.licenseType" class="w-full border p-3 rounded-xl bg-white"><option>A Umum</option><option>B1 Umum</option><option>B2 Umum</option></select><select v-model="driverModal.data.status" class="w-full border p-3 rounded-xl bg-white"><option>Standby</option><option>Libur</option></select></div></div><div class="mt-6 flex justify-end gap-3"><button @click="closeDriverModal" class="px-4 py-2 text-gray-500 font-bold hover:bg-gray-100 rounded-lg">Batal</button><button @click="saveDriver" class="px-6 py-2 bg-green-600 text-white rounded-xl font-bold hover:bg-green-700">Simpan Data</button></div></div></div>

    </div>
    <script src="app.js"></script>
</body>
</html>