<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sutan Raya - Flight Deck Operasional</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
    <style>
        html { scroll-behavior: smooth; }
        .view-enter-active, .view-leave-active { transition: opacity 0.3s ease, transform 0.3s ease; }
        .view-enter-from { opacity: 0; transform: translateX(20px); }
        .view-leave-to { opacity: 0; transform: translateX(-20px); }
        .list-enter-active, .list-leave-active { transition: all 0.5s ease; }
        .list-enter-from, .list-leave-to { opacity: 0; transform: translateX(30px); }
    </style>
    <script>
        tailwind.config = { theme: { extend: { colors: { 'sutan-blue': { '900': '#0A2342', '800': '#123458', '700': '#2C3E50' }, 'sutan-gold': '#D4AF37' } } } }
    </script>
</head>
<body class="bg-gray-100 font-sans">

    <div id="app" class="flex h-screen bg-sutan-blue-900 text-gray-800">
        
        <nav class="w-64 bg-white flex-shrink-0 border-r border-gray-200 flex flex-col" :class="{ 'hidden': isFullscreen }">
            <div class="h-24 flex items-center justify-center border-b border-gray-200"><div class="brand text-4xl text-sutan-blue-900">SutanRaya</div></div>
            <ul class="flex-grow p-4">
                <li @click="view = 'dashboard'" :class="view === 'dashboard' ? 'bg-sutan-blue-800 text-white' : 'hover:bg-gray-100'" class="flex items-center p-3 rounded-lg cursor-pointer transition-colors duration-200 mb-2"><i class="bi bi-window-split w-6 text-xl"></i><span class="ml-4 font-semibold">Dashboard</span></li>
                <li @click="view = 'inventaris'" :class="view === 'inventaris' ? 'bg-sutan-blue-800 text-white' : 'hover:bg-gray-100'" class="flex items-center p-3 rounded-lg cursor-pointer transition-colors duration-200 mb-2"><i class="bi bi-truck-front-fill w-6 text-xl"></i><span class="ml-4 font-semibold">Inventaris</span></li>
                <li @click="view = 'drivers'" :class="view === 'drivers' ? 'bg-sutan-blue-800 text-white' : 'hover:bg-gray-100'" class="flex items-center p-3 rounded-lg cursor-pointer transition-colors duration-200 mb-2"><i class="bi bi-person-badge-fill w-6 text-xl"></i><span class="ml-4 font-semibold">Kelola Supir</span></li>
                <li @click="view = 'history'" :class="view === 'history' ? 'bg-sutan-blue-800 text-white' : 'hover:bg-gray-100'" class="flex items-center p-3 rounded-lg cursor-pointer transition-colors duration-200 mb-2"><i class="bi bi-clock-history w-6 text-xl"></i><span class="ml-4 font-semibold">Riwayat</span></li>
                <li @click="view = 'display'" :class="view === 'display' ? 'bg-sutan-blue-800 text-white' : 'hover:bg-gray-100'" class="flex items-center p-3 rounded-lg cursor-pointer transition-colors duration-200 mb-2"><i class="bi bi-display-fill w-6 text-xl"></i><span class="ml-4 font-semibold">Layar Display</span></li>
                <li @click="view = 'admin'" :class="view === 'admin' ? 'bg-sutan-blue-800 text-white' : 'hover:bg-gray-100'" class="flex items-center p-3 rounded-lg cursor-pointer transition-colors duration-200 mb-2 mt-8 border-t pt-4"><i class="bi bi-sliders w-6 text-xl"></i><span class="ml-4 font-semibold">Panel Admin</span></li>
            </ul>
        </nav>

        <main class="flex-1 flex flex-col" :class="{ 'w-full h-full': isFullscreen }">
            <header class="h-24 bg-white border-b border-gray-200 flex-shrink-0 flex items-center justify-between px-8" :class="{ 'hidden': isFullscreen }">
                <h1 class="text-3xl font-bold text-sutan-blue-900">{{ currentViewTitle }}</h1>
                <div class="flex items-center gap-6">
                    <button v-if="view === 'display'" @click="toggleFullscreen" class="text-gray-500 hover:text-sutan-blue-800 text-2xl transition-transform duration-200 ease-in-out hover:scale-110 active:scale-95"><i :class="isFullscreen ? 'bi-arrows-angle-contract' : 'bi-arrows-fullscreen'"></i></button>
                    <div class="text-right">
                        <div id="date" class="font-semibold text-gray-600">{{ currentDate }}</div>
                        <div id="clock" class="text-2xl font-bold text-sutan-blue-900">{{ currentTime }}</div>
                    </div>
                </div>
            </header>

            <div class="flex-1 overflow-y-auto bg-gray-100 relative" :class="isFullscreen ? 'p-0' : 'p-8'">
                <transition name="view" mode="out-in">
                    <div :key="view">
                        <div v-if="view === 'dashboard'">
                            <div class="mb-6 bg-white/80 backdrop-blur-sm p-2 rounded-full shadow-sm flex items-center justify-center gap-4 sticky top-0 z-10">
                                <a href="#panel-keberangkatan" class="px-4 py-1.5 text-sm font-semibold text-gray-700 hover:bg-sutan-blue-800 hover:text-white rounded-full transition-colors">Keberangkatan</a>
                                <a href="#panel-kedatangan" class="px-4 py-1.5 text-sm font-semibold text-gray-700 hover:bg-sutan-blue-800 hover:text-white rounded-full transition-colors">Kedatangan</a>
                                <a href="#panel-rental" class="px-4 py-1.5 text-sm font-semibold text-gray-700 hover:bg-sutan-blue-800 hover:text-white rounded-full transition-colors">Rental Aktif</a>
                                <a href="#panel-armada-siap" class="px-4 py-1.5 text-sm font-semibold text-gray-700 hover:bg-sutan-blue-800 hover:text-white rounded-full transition-colors">Armada Siap</a>
                                <a href="#panel-supir-siap" class="px-4 py-1.5 text-sm font-semibold text-gray-700 hover:bg-sutan-blue-800 hover:text-white rounded-full transition-colors">Supir Siap</a>
                            </div>

                            <div class="columns-1 xl:columns-2 gap-8 space-y-8">
                                <div id="panel-keberangkatan" class="bg-white rounded-xl shadow-lg p-6 flex flex-col break-inside-avoid"><h2 class="text-xl font-bold text-sutan-blue-900 flex items-center mb-4"><i class="bi bi-box-arrow-up mr-3"></i> KEBERANGKATAN (DARI PDG) <span class="ml-4 text-sm font-medium bg-gray-200 text-gray-700 px-3 py-1 rounded-full">{{ departures.length }}</span></h2><div class="overflow-y-auto pr-2"><div v-for="trip in departures" @click="openTripModal(trip)" class="grid grid-cols-12 items-center p-3 rounded-lg hover:bg-gray-50 cursor-pointer border-b"><div class="col-span-2 font-extrabold text-2xl text-sutan-blue-800">{{ formatTime(trip.departureTime) }}</div><div class="col-span-5"><div class="font-bold text-lg">{{ trip.destinationCode }}</div><div class="text-sm text-gray-500">{{ trip.fleet.name }}</div><div class="text-xs text-red-600 font-semibold mt-1"><i class="bi bi-fuel-pump-fill"></i> Est. Biaya: {{ formatRupiah(trip.tripCost) }}</div></div><div class="col-span-2 text-center text-gray-600 font-semibold"><i class="bi bi-people-fill mr-2"></i>{{ trip.pax }}</div><div class="col-span-3 text-right"><span class="px-4 py-1.5 text-sm font-bold rounded-full" :class="statusClasses[trip.status]">{{ trip.status }}</span></div></div></div></div>
                                <div id="panel-rental" class="bg-white rounded-xl shadow-lg p-6 flex flex-col break-inside-avoid"><h2 class="text-xl font-bold text-sutan-blue-900 flex items-center mb-4"><i class="bi bi-camera-reels-fill mr-3"></i> RENTAL AKTIF <span class="ml-4 text-sm font-medium bg-gray-200 text-gray-700 px-3 py-1 rounded-full">{{ rental.length }}</span></h2><div class="overflow-y-auto pr-2 space-y-4"><div v-for="trip in rental" @click="openTripModal(trip)" class="p-4 border rounded-lg flex flex-col cursor-pointer hover:border-purple-400 hover:shadow-lg transition-all"><div class="flex justify-between items-start"><div><div class="font-bold text-lg text-purple-800 truncate">{{ trip.notes }}</div><div class="text-sm text-gray-500 font-medium">{{ trip.fleet.name }}</div></div><span class="flex items-center text-sm font-bold bg-purple-100 text-purple-800 px-3 py-1 rounded-full"><span class="w-2 h-2 bg-purple-500 rounded-full mr-2 animate-pulse"></span>LIVE</span></div><div class="mt-3 text-xs text-gray-500"><span>Mulai: <strong>{{ formatDateTime(trip.departureTime) }}</strong></span><br><span>Selesai: <strong>{{ formatDateTime(trip.arrivalTime) }}</strong></span></div><div class="mt-3"><div class="flex justify-between text-sm font-semibold mb-1"><span class="text-green-600">Berjalan: {{ calculateElapsedTime(trip.departureTime) }}</span><span class="text-gray-600">Total: {{ trip.totalDurationFormatted }}</span></div><div class="w-full bg-gray-200 rounded-full h-2.5"><div class="bg-green-500 h-2.5 rounded-full" :style="{ width: calculateProgress(trip) + '%' }"></div></div></div></div></div></div>
                                <div id="panel-kedatangan" class="bg-white rounded-xl shadow-lg p-6 flex flex-col break-inside-avoid"><h2 class="text-xl font-bold text-sutan-blue-900 flex items-center mb-4"><i class="bi bi-box-arrow-down mr-3"></i> KEDATANGAN (KE PDG) <span class="ml-4 text-sm font-medium bg-gray-200 text-gray-700 px-3 py-1 rounded-full">{{ arrivals.length }}</span></h2><div class="overflow-y-auto pr-2"><div v-for="trip in arrivals" @click="openTripModal(trip)" class="grid grid-cols-12 items-center p-3 rounded-lg hover:bg-gray-50 cursor-pointer border-b"><div class="col-span-2 font-extrabold text-2xl text-sutan-blue-800">{{ formatTime(trip.arrivalTime) }}</div><div class="col-span-5"><div class="font-bold text-lg">{{ trip.originCode }}</div><div class="text-sm text-gray-500">{{ trip.fleet.name }}</div><div class="text-xs text-red-600 font-semibold mt-1"><i class="bi bi-fuel-pump-fill"></i> Est. Biaya: {{ formatRupiah(trip.tripCost) }}</div></div><div class="col-span-2 text-center text-gray-600 font-semibold"><i class="bi bi-people-fill mr-2"></i>{{ trip.pax }}</div><div class="col-span-3 text-right"><span class="px-4 py-1.5 text-sm font-bold rounded-full" :class="statusClasses[trip.status]">{{ trip.status }}</span></div></div></div></div>
                                <div id="panel-armada-siap" class="bg-white rounded-xl shadow-lg p-6 flex flex-col break-inside-avoid"><h2 class="text-xl font-bold text-sutan-blue-900 flex items-center mb-4"><i class="bi bi-p-circle-fill mr-3"></i> ARMADA SIAP OPERASI <span class="ml-4 text-sm font-medium bg-gray-200 text-gray-700 px-3 py-1 rounded-full">{{ armadaStandby.length }}</span></h2><div class="overflow-y-auto pr-2 space-y-4"><div><h3 class="font-bold text-yellow-600 border-b-2 border-yellow-500 mb-2 pb-1">Hiace ({{standbyHiace.length}})</h3><div class="space-y-2"><div v-for="armada in standbyHiace" @click="openTripWizard(armada.id)" class="flex items-center p-2 rounded-md hover:bg-gray-50 cursor-pointer"><i :class="armada.icon" class="text-2xl text-yellow-500"></i><div class="ml-3"><div class="font-bold text-sm">{{ armada.name }}</div><div class="text-xs text-gray-500">{{ armada.plate }}</div></div></div></div></div><div><h3 class="font-bold text-blue-600 border-b-2 border-blue-500 mb-2 pb-1">Medium Bus ({{standbyMediumBus.length}})</h3><div class="space-y-2"><div v-for="armada in standbyMediumBus" @click="openTripWizard(armada.id)" class="flex items-center p-2 rounded-md hover:bg-gray-50 cursor-pointer"><i :class="armada.icon" class="text-2xl text-blue-500"></i><div class="ml-3"><div class="font-bold text-sm">{{ armada.name }}</div><div class="text-xs text-gray-500">{{ armada.plate }}</div></div></div></div></div><div><h3 class="font-bold text-indigo-600 border-b-2 border-indigo-500 mb-2 pb-1">Big Bus ({{standbyBigBus.length}})</h3><div class="space-y-2"><div v-for="armada in standbyBigBus" @click="openTripWizard(armada.id)" class="flex items-center p-2 rounded-md hover:bg-gray-50 cursor-pointer"><i :class="armada.icon" class="text-2xl text-indigo-500"></i><div class="ml-3"><div class="font-bold text-sm">{{ armada.name }}</div><div class="text-xs text-gray-500">{{ armada.plate }}</div></div></div></div></div></div></div>
                                <div id="panel-supir-siap" class="bg-white rounded-xl shadow-lg p-6 flex flex-col break-inside-avoid"><h2 class="text-xl font-bold text-sutan-blue-900 flex items-center mb-4"><i class="bi bi-person-check-fill mr-3"></i> SUPIR SIAP BERTUGAS <span class="ml-4 text-sm font-medium bg-gray-200 text-gray-700 px-3 py-1 rounded-full">{{ standbyDrivers.length }}</span></h2><div class="overflow-y-auto pr-2"><div class="space-y-2"><div v-for="driver in standbyDrivers" class="flex items-center p-2 border-b"><i class="bi bi-person-circle text-2xl text-green-500"></i><div class="ml-3"><div class="font-bold text-sm">{{ driver.name }}</div><div class="text-xs text-gray-500">{{ driver.licenseType }}</div></div></div></div></div></div>
                            </div>
                        </div>
                        
                        <div v-if="view === 'inventaris'"><div class="bg-white p-6 rounded-xl shadow-lg"><div class="flex justify-between items-center mb-6"><div class="relative w-1/3"><i class="bi bi-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i><input type="text" v-model="armadaSearchTerm" placeholder="Cari armada, plat, atau status..." class="w-full pl-10 pr-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"></div><button @click="openVehicleModal(null)" class="bg-sutan-blue-800 text-white font-bold py-2 px-6 rounded-lg hover:bg-sutan-blue-900 transition-all duration-200 flex items-center active:scale-95"><i class="bi bi-plus-circle-fill mr-2"></i> Tambah Kendaraan</button></div><table class="w-full text-left"><thead class="bg-gray-100 text-gray-700 uppercase text-sm"><tr><th class="p-4">Nama Armada</th><th class="p-4">Jenis</th><th class="p-4">Servis Berikutnya</th><th class="p-4">Harga</th><th class="p-4">Status</th><th class="p-4">Aksi</th></tr></thead><tbody><tr v-for="vehicle in filteredFleet" :key="vehicle.id" class="border-b hover:bg-gray-50"><td class="p-4 font-semibold">{{ vehicle.name }}<br><span class="bg-gray-700 text-white px-2 py-0.5 rounded-md font-mono text-xs">{{ vehicle.plate }}</span></td><td class="p-4">{{ vehicle.type }}</td><td class="p-4" :class="{'text-red-500 font-bold': isServiceDue(vehicle.nextService)}"><i class="bi bi-wrench-adjustable-circle-fill mr-2" :class="isServiceDue(vehicle.nextService) ? 'text-red-500 animate-pulse' : 'text-gray-400'"></i>{{ formatFullDate(vehicle.nextService) }}</td><td class="p-4 font-semibold text-green-700"><div v-if="vehicle.hargaSewa">{{ formatRupiah(vehicle.hargaSewa) }} / hari</div><div v-if="vehicle.hargaPerOrang" class="text-sm text-blue-700">{{ formatRupiah(vehicle.hargaPerOrang) }} / orang</div></td><td class="p-4"><span class="px-3 py-1 text-xs font-bold rounded-full" :class="getVehicleStatusClass(vehicle.status)">{{ vehicle.status }}</span></td><td class="p-4"><button @click="openVehicleModal(vehicle)" class="text-blue-600 hover:text-blue-800 active:text-blue-900 transition-all"><i class="bi bi-pencil-fill"></i> Edit</button></td></tr></tbody></table></div></div>
                        <div v-if="view === 'drivers'"><div class="bg-white p-6 rounded-xl shadow-lg"><div class="flex justify-between items-center mb-6"><div class="relative w-1/3"><i class="bi bi-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i><input type="text" v-model="driverSearchTerm" placeholder="Cari nama supir..." class="w-full pl-10 pr-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"></div><button @click="openDriverModal(null)" class="bg-sutan-blue-800 text-white font-bold py-2 px-6 rounded-lg hover:bg-sutan-blue-900 transition-all duration-200 flex items-center active:scale-95"><i class="bi bi-plus-circle-fill mr-2"></i> Tambah Supir</button></div><table class="w-full text-left"><thead class="bg-gray-100 text-gray-700 uppercase text-sm"><tr><th class="p-4">Nama Supir</th><th class="p-4">Jenis SIM</th><th class="p-4">No. Telepon</th><th class="p-4">Status</th><th class="p-4">Aksi</th></tr></thead><tbody><tr v-for="driver in filteredDrivers" :key="driver.id" class="border-b hover:bg-gray-50"><td class="p-4 font-semibold">{{ driver.name }}</td><td class="p-4"><span class="font-mono text-sm bg-gray-200 px-2 py-1 rounded">{{ driver.licenseType }}</span></td><td class="p-4">{{ driver.phone }}</td><td class="p-4"><span class="px-3 py-1 text-xs font-bold rounded-full" :class="getDriverStatusClass(driver.status)">{{ driver.status }}</span></td><td class="p-4"><button @click="openDriverModal(driver)" class="text-blue-600 hover:text-blue-800 active:text-blue-900 transition-all"><i class="bi bi-pencil-fill"></i> Edit</button></td></tr></tbody></table></div></div>
                        <div v-if="view === 'history'"><div class="bg-white p-6 rounded-xl shadow-lg"><h2 class="text-xl font-bold text-sutan-blue-900 flex items-center mb-4"><i class="bi bi-check2-circle mr-3"></i> RIWAYAT PERJALANAN SELESAI <span class="ml-4 text-sm font-medium bg-gray-200 text-gray-700 px-3 py-1 rounded-full">{{ filteredHistory.length }}</span></h2><div class="relative w-1/3 mb-6"><i class="bi bi-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i><input type="text" v-model="historySearchTerm" placeholder="Cari riwayat..." class="w-full pl-10 pr-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"></div><div class="space-y-4"><div v-if="filteredHistory.length === 0" class="text-center py-8 text-gray-500">Tidak ada riwayat yang cocok.</div><div v-else v-for="trip in filteredHistory" @click="openTripModal(trip)" class="p-4 bg-gray-50 rounded-lg border cursor-pointer hover:border-blue-400"><div class="grid grid-cols-12 items-center"><div class="col-span-4"><span class="font-bold text-lg">{{ trip.originCode }} <span v-if="!trip.destinationCode" class="text-gray-500">({{trip.notes}})</span></span><i v-if="trip.destinationCode" class="bi bi-arrow-right-short mx-2"></i><span v-if="trip.destinationCode" class="font-bold text-lg">{{ trip.destinationCode }}</span></div><div class="col-span-3 text-gray-600"><i class="bi bi-calendar3 mr-2"></i> {{ formatFullDate(trip.departureTime) }}</div><div class="col-span-3 text-gray-600"><i :class="trip.fleet.icon" class="mr-2"></i> {{ trip.fleet.name }}</div><div class="col-span-2 text-right"><span class="px-4 py-1.5 text-sm font-bold rounded-full" :class="statusClasses[trip.status]">{{ trip.status }}</span></div></div><div v-if="trip.tripRevenue > 0" class="mt-3 pt-3 border-t grid grid-cols-3 gap-4 text-center"><div><div class="text-xs text-gray-500">Total Pendapatan</div><div class="font-bold text-blue-600">{{ formatRupiah(trip.tripRevenue) }}</div></div><div><div class="text-xs text-gray-500">Biaya Operasional</div><div class="font-bold text-red-600">{{ formatRupiah(trip.tripCost) }}</div></div><div><div class="text-xs text-gray-500">Keuntungan</div><div class="font-bold text-lg" :class="trip.tripProfit >= 0 ? 'text-green-600' : 'text-red-600'">{{ formatRupiah(trip.tripProfit) }}</div></div></div></div></div></div></div>
                        <div v-if="view === 'display'"><div class="h-full grid grid-cols-1 lg:grid-cols-2 gap-8" :class="isFullscreen ? 'gap-0' : ''"><div class="bg-sutan-blue-900 p-6 rounded-xl h-full flex flex-col" :class="isFullscreen ? 'rounded-none' : ''"><h2 class="text-3xl font-bold text-white flex items-center pb-4 border-b-4 border-sutan-gold mb-2"><i class="bi bi-box-arrow-right mr-4"></i> KEBERANGKATAN</h2><div class="text-sutan-gold font-bold text-lg uppercase grid grid-cols-12 gap-4 px-4 py-2"><div class="col-span-2">Time</div><div class="col-span-5">Destination</div><div class="col-span-3">Fleet</div><div class="col-span-2 text-right">Status</div></div><transition-group name="list" tag="div" class="flex-grow space-y-3 overflow-y-auto pr-2"><div v-for="trip in upcomingDeparturesForDisplay" :key="trip.id" class="grid grid-cols-12 gap-4 items-center bg-sutan-blue-800 text-white rounded-lg p-4 text-2xl lg:text-3xl font-bold"><div class="col-span-2">{{ formatTime(trip.departureTime) }}</div><div class="col-span-5 truncate">{{ trip.destinationCode || 'RENTAL' }}</div><div class="col-span-3 text-xl lg:text-2xl font-medium text-gray-300 truncate">{{ trip.fleet.name }}</div><div class="col-span-2 text-right"><span class="text-lg lg:text-xl font-bold px-4 py-2 rounded-full" :class="statusClasses[trip.status]">{{ trip.status }}</span></div></div></transition-group></div><div class="bg-sutan-blue-900 p-6 rounded-xl h-full flex flex-col" :class="isFullscreen ? 'rounded-none' : ''"><h2 class="text-3xl font-bold text-white flex items-center pb-4 border-b-4 border-sutan-gold mb-2"><i class="bi bi-box-arrow-in-left mr-4"></i> KEDATANGAN</h2><div class="text-sutan-gold font-bold text-lg uppercase grid grid-cols-12 gap-4 px-4 py-2"><div class="col-span-2">ETA</div><div class="col-span-5">Origin</div><div class="col-span-3">Fleet</div><div class="col-span-2 text-right">Status</div></div><transition-group name="list" tag="div" class="flex-grow space-y-3 overflow-y-auto pr-2"><div v-for="trip in upcomingArrivalsForDisplay" :key="trip.id" class="grid grid-cols-12 gap-4 items-center bg-sutan-blue-800 text-white rounded-lg p-4 text-2xl lg:text-3xl font-bold"><div class="col-span-2">{{ formatTime(trip.arrivalTime) }}</div><div class="col-span-5 truncate">{{ trip.originCode }}</div><div class="col-span-3 text-xl lg:text-2xl font-medium text-gray-300 truncate">{{ trip.fleet.name }}</div><div class="col-span-2 text-right"><span class="text-lg lg:text-xl font-bold px-4 py-2 rounded-full" :class="statusClasses[trip.status]">{{ trip.status }}</span></div></div></transition-group></div></div></div>
                        <div v-if="view === 'admin'"><div class="bg-white p-6 rounded-xl shadow-lg"><h2 class="text-2xl font-bold text-sutan-blue-900 flex items-center mb-6"><i class="bi bi-cash-coin mr-3"></i> Manajemen Harga dan Biaya Operasional</h2><div class="overflow-x-auto"><table class="w-full text-left"><thead class="bg-gray-100 text-gray-700 uppercase text-sm"><tr><th class="p-4">Nama Armada</th><th class="p-4">Jenis</th><th class="p-4 w-1/4">Harga Sewa / Hari (Rp)</th><th class="p-4 w-1/4">Harga Per Orang (Rp)</th><th class="p-4 w-1/4">Biaya Operasional / Hari (Rp)</th></tr></thead><tbody><tr v-for="armada in fleet" :key="armada.id" class="border-b"><td class="p-4 font-semibold">{{ armada.name }}</td><td class="p-4">{{ armada.type }}</td><td class="p-4"><input type="number" v-model.number="armada.hargaSewa" class="w-full p-2 border rounded-md bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="N/A"></td><td class="p-4"><input type="number" v-model.number="armada.hargaPerOrang" class="w-full p-2 border rounded-md bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="N/A"></td><td class="p-4"><input type="number" v-model.number="armada.biayaOperasional" class="w-full p-2 border rounded-md bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500"></td></tr></tbody></table></div><div class="mt-6 flex justify-end items-center"><span v-if="pricesSavedMessage" class="text-green-600 font-semibold mr-4">{{ pricesSavedMessage }}</span><button @click="savePrices" class="bg-sutan-blue-800 text-white font-bold py-2 px-8 rounded-lg hover:bg-sutan-blue-900 active:scale-95 transition-all flex items-center"><i class="bi bi-save-fill mr-2"></i> Simpan Perubahan</button></div></div></div>
                    </div>
                </transition>
            </div>
        </main>
        
        <div v-if="isTripWizardVisible" @click.self="closeTripWizard" class="fixed inset-0 bg-black bg-opacity-60 z-50 flex items-center justify-center p-4"><div class="bg-white rounded-xl shadow-2xl w-full max-w-3xl flex flex-col max-h-[90vh]"><div class="flex justify-between items-center p-6 border-b"><h3 class="text-2xl font-bold text-sutan-blue-900">Buat Jadwal Baru</h3><button @click="closeTripWizard" class="text-gray-400 hover:text-gray-800 text-2xl active:text-gray-900">&times;</button></div><div class="p-6 overflow-hidden flex-grow" v-if="wizard.trip"><div class="flex transition-transform duration-300 ease-in-out" :style="{ transform: `translateX(-${(wizard.step - 1) * 100}%)` }"><div class="w-full flex-shrink-0 px-2"><h4 class="font-bold text-lg mb-4">Langkah 1: Tentukan Jenis Perjalanan</h4><div class="grid grid-cols-2 gap-4"><div @click="wizard.trip.type = 'Rute'" class="p-4 border-2 rounded-lg cursor-pointer text-center transition-all" :class="wizard.trip.type === 'Rute' ? 'border-blue-500 bg-blue-50' : 'hover:border-gray-400'"><i class="bi bi-signpost-split-fill text-4xl text-blue-500 mb-2"></i><div class="font-semibold">Perjalanan Rute</div></div><div @click="wizard.trip.type = 'Rental'" class="p-4 border-2 rounded-lg cursor-pointer text-center transition-all" :class="wizard.trip.type === 'Rental' ? 'border-purple-500 bg-purple-50' : 'hover:border-gray-400'"><i class="bi bi-calendar2-event-fill text-4xl text-purple-500 mb-2"></i><div class="font-semibold">Sewa / Rental</div></div></div><div class="mt-4"><template v-if="wizard.trip.type === 'Rute'"><div class="grid grid-cols-2 gap-4"><div><label class="font-semibold block mb-1">Asal</label><select v-model="wizard.trip.origin" class="w-full p-2 border rounded-md bg-gray-50"><option v-for="loc in locations" :value="loc.name">{{ loc.name }} ({{loc.code}})</option></select></div><div><label class="font-semibold block mb-1">Tujuan</label><select v-model="wizard.trip.destination" class="w-full p-2 border rounded-md bg-gray-50"><option v-for="loc in locations" :value="loc.name">{{ loc.name }} ({{loc.code}})</option></select></div></div></template><template v-else><div><label class="font-semibold block mb-1">Keterangan Rental</label><input type="text" v-model="wizard.trip.notes" placeholder="e.g., Sewa Harian - Dinas Pariwisata" class="w-full p-2 border rounded-md bg-gray-50"></div></template></div></div><div class="w-full flex-shrink-0 px-2"><h4 class="font-bold text-lg mb-4">Langkah 2: Pilih Jadwal</h4><div v-if="wizard.trip.type === 'Rute'"><div><label class="font-semibold block mb-1">Tanggal Berangkat</label><div class="flex gap-2 mb-4 items-center"><button @click="setWizardDate('today')" :class="wizard.date.type === 'today' ? 'bg-blue-600 text-white' : 'bg-gray-200'" class="px-4 py-2 rounded-md font-semibold">Hari Ini</button><button @click="setWizardDate('tomorrow')" :class="wizard.date.type === 'tomorrow' ? 'bg-blue-600 text-white' : 'bg-gray-200'" class="px-4 py-2 rounded-md font-semibold">Besok</button><input type="date" v-model="wizard.date.raw" @change="setWizardDate('custom')" class="p-2 border rounded-md bg-gray-50"></div></div><div><label class="font-semibold block mb-1">Jam Berangkat</label><div class="grid grid-cols-5 gap-2 mb-4"><button v-for="time in commonTimes" @click="wizard.time = time" :class="wizard.time === time ? 'bg-blue-600 text-white' : 'bg-gray-200'" class="p-2 rounded-md font-semibold">{{time}}</button><input type="time" v-model="wizard.time" class="p-2 border rounded-md bg-gray-50 col-span-2"></div></div></div><div v-if="wizard.trip.type === 'Rental'" class="grid grid-cols-2 gap-6"><div><h5 class="font-semibold mb-2">Jadwal Mulai Sewa</h5><div class="space-y-2"><label class="block text-sm">Tanggal Mulai</label><input type="date" v-model="wizard.date.raw" class="w-full p-2 border rounded-md bg-gray-50"><label class="block text-sm mt-2">Jam Mulai</label><input type="time" v-model="wizard.time" class="w-full p-2 border rounded-md bg-gray-50"></div></div><div><h5 class="font-semibold mb-2">Jadwal Selesai Sewa</h5><div class="space-y-2"><label class="block text-sm">Tanggal Selesai</label><input type="date" v-model="wizard.endDate.raw" class="w-full p-2 border rounded-md bg-gray-50"><label class="block text-sm mt-2">Jam Selesai</label><input type="time" v-model="wizard.endTime" class="w-full p-2 border rounded-md bg-gray-50"></div></div></div></div><div class="w-full flex-shrink-0 px-2"><h4 class="font-bold text-lg mb-4">Langkah 3: Pilih Armada & Supir</h4><div class="grid grid-cols-2 gap-6"><div><label class="font-semibold block mb-1">Armada</label><select v-model="wizard.trip.fleetId" class="w-full p-2 border rounded-md bg-gray-50"><option disabled value="">Pilih armada...</option><option v-for="f in availableFleetForTrip" :value="f.id">{{ f.name }}</option></select></div><div><label class="font-semibold block mb-1">Supir</label><div class="relative"><input type="text" v-model="driverSearchTermInModal" placeholder="Cari & pilih supir..." class="w-full p-2 border rounded-md bg-gray-50" @focus="showDriverDropdown = true" @blur="hideDriverDropdownWithDelay"><div v-if="showDriverDropdown" class="absolute z-10 w-full bg-white border rounded-md mt-1 max-h-40 overflow-y-auto"><div v-for="driver in availableDriversForTrip" @mousedown.prevent="selectDriver(driver, 'wizard')" class="p-2 hover:bg-gray-100 cursor-pointer">{{ driver.name }} ({{driver.licenseType}})</div><div v-if="!availableDriversForTrip.length" class="p-2 text-gray-500">Tidak ada supir tersedia.</div></div></div><div v-if="selectedDriverNameForWizard" class="mt-2 p-2 bg-blue-100 text-blue-800 rounded-md text-sm font-semibold">Supir terpilih: {{ selectedDriverNameForWizard }}</div></div><div class="col-span-2"><label class="font-semibold block mb-1">Penumpang/Tipe</label><input type="text" v-model="wizard.trip.pax" placeholder="e.g., 7/7, Carter" class="w-full p-2 border rounded-md bg-gray-50"></div></div></div></div></div><div class="p-6 border-t mt-auto flex justify-between items-center"><div><button v-if="wizard.step > 1" @click="wizard.step--" class="bg-gray-200 text-gray-800 font-bold py-2 px-6 rounded-lg hover:bg-gray-300 active:scale-95 transition-all">Kembali</button></div><div><button v-if="wizard.step < 3" @click="wizard.step++" class="bg-sutan-blue-800 text-white font-bold py-2 px-6 rounded-lg hover:bg-sutan-blue-900 active:scale-95 transition-all">Lanjut</button><button v-if="wizard.step === 3" @click="saveTripFromWizard" class="bg-green-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-green-700 active:scale-95 transition-all">Buat Jadwal</button></div></div></div></div>
        <div v-if="isTripModalVisible" @click.self="closeTripModal" class="fixed inset-0 bg-black bg-opacity-60 z-50 flex items-center justify-center p-4"><div class="bg-white rounded-xl shadow-2xl w-full max-w-3xl flex flex-col max-h-[90vh]"><div class="flex justify-between items-center p-6 border-b"><h3 class="text-2xl font-bold text-sutan-blue-900">Edit Jadwal Perjalanan</h3><button @click="closeTripModal" class="text-gray-400 hover:text-gray-800 text-2xl active:text-gray-900">&times;</button></div><div class="p-6 overflow-y-auto" v-if="modal.trip"><div class="grid grid-cols-2 gap-x-6 gap-y-4"><div class="col-span-2"><label class="font-semibold block mb-1">Armada</label><input type="text" :value="modal.trip.fleet.name" class="w-full p-2 border rounded-md bg-gray-200" readonly></div><div class="col-span-2"><label class="font-semibold block mb-1">Supir</label><input type="text" :value="modal.trip.driver.name" class="w-full p-2 border rounded-md bg-gray-200" readonly></div><template v-if="modal.trip.type === 'Rute'"><div class="col-span-2"><label class="font-semibold block mb-1">Rute</label><input type="text" :value="`${modal.trip.origin} -> ${modal.trip.destination}`" class="w-full p-2 border rounded-md bg-gray-200" readonly></div></template><template v-else><div class="col-span-2"><label class="font-semibold block mb-1">Keterangan Rental</label><input type="text" v-model="modal.trip.notes" class="w-full p-2 border rounded-md bg-gray-50"></div></template><div><label class="font-semibold block mb-1">Waktu Berangkat</label><input type="datetime-local" v-model="modal.trip.departureTime" class="w-full p-2 border rounded-md bg-gray-50"></div><div><label class="font-semibold block mb-1">Waktu Tiba (Estimasi)</label><input type="datetime-local" v-model="modal.trip.arrivalTime" class="w-full p-2 border rounded-md bg-gray-50"></div><div class="col-span-2"><label class="font-semibold block mb-1">Penumpang/Tipe</label><input type="text" v-model="modal.trip.pax" class="w-full p-2 border rounded-md bg-gray-50"></div></div><div v-if="modal.trip.tripRevenue > 0 && modal.trip.status === 'Tiba'" class="mt-6 pt-4 border-t"><h4 class="font-bold text-lg mb-2">Rincian Finansial</h4><div class="grid grid-cols-3 gap-4 text-center bg-gray-50 p-4 rounded-lg"><div><div class="text-sm text-gray-500">Total Pendapatan</div><div class="font-bold text-xl text-blue-600">{{ formatRupiah(modal.trip.tripRevenue) }}</div></div><div><div class="text-sm text-gray-500">Biaya Operasional</div><div class="font-bold text-xl text-red-600">{{ formatRupiah(modal.trip.tripCost) }}</div></div><div><div class="text-sm text-gray-500">Keuntungan</div><div class="font-bold text-2xl" :class="modal.trip.tripProfit >= 0 ? 'text-green-600' : 'text-red-600'">{{ formatRupiah(modal.trip.tripProfit) }}</div></div></div></div></div><div class="p-6 border-t mt-auto"><div class="mb-4"><p class="font-semibold mb-2">Ubah Status Cepat:</p><div class="flex flex-wrap gap-2"><button v-for="s in statuses" @click="updateTripStatus(modal.trip.id, s)" class="px-3 py-1 text-sm font-bold rounded-full transition-transform active:scale-95" :class="[statusClasses[s], modal.trip.status === s ? 'ring-2 ring-offset-1 ring-blue-500' : '']">{{ s }}</button></div></div><div class="flex justify-between items-center pt-4 border-t"><div><button @click="deleteTrip(modal.trip.id)" class="bg-red-600 text-white font-bold py-2 px-5 rounded-lg hover:bg-red-700 transition-all active:scale-95">Hapus Jadwal</button></div><button @click="saveTrip" class="bg-sutan-blue-800 text-white font-bold py-2 px-8 rounded-lg hover:bg-sutan-blue-900 transition-all active:scale-95">Simpan Perubahan</button></div></div></div></div>
        <div v-if="isVehicleModalVisible" @click.self="closeVehicleModal" class="fixed inset-0 bg-black bg-opacity-60 z-50 flex items-center justify-center"><div class="bg-white rounded-xl shadow-2xl w-full max-w-xl"><div class="flex justify-between items-center p-6 border-b"><h3 class="text-2xl font-bold text-sutan-blue-900">{{ vehicleModal.mode === 'add' ? 'Tambah Kendaraan Baru' : 'Edit Kendaraan' }}</h3><button @click="closeVehicleModal" class="text-gray-400 hover:text-gray-800 text-2xl">&times;</button></div><div class="p-6"><div class="grid grid-cols-2 gap-6"><div><label class="font-semibold block mb-1">Nama Armada</label><input type="text" v-model="vehicleModal.data.name" placeholder="Contoh: Hiace Premio SR-01" class="w-full p-2 border rounded-md bg-gray-50"></div><div><label class="font-semibold block mb-1">Plat Nomor</label><input type="text" v-model="vehicleModal.data.plate" placeholder="Contoh: BA 1234 XX" class="w-full p-2 border rounded-md bg-gray-50"></div><div><label class="font-semibold block mb-1">Jenis Kendaraan</label><select v-model="vehicleModal.data.type" class="w-full p-2 border rounded-md bg-gray-50"><option>Hiace Premio</option><option>Hiace Commuter</option><option>Medium Bus</option><option>Big Bus</option></select></div><div><label class="font-semibold block mb-1">Kapasitas Kursi</label><input type="number" v-model.number="vehicleModal.data.capacity" class="w-full p-2 border rounded-md bg-gray-50"></div><div class="col-span-2"><label class="font-semibold block mb-1">Status Kendaraan</label><select v-model="vehicleModal.data.status" class="w-full p-2 border rounded-md bg-gray-50"><option>Tersedia</option><option>Perbaikan</option></select></div></div></div><div class="p-6 border-t flex justify-end"><button @click="saveVehicle" class="bg-sutan-blue-800 text-white font-bold py-2 px-8 rounded-lg hover:bg-sutan-blue-900">Simpan Kendaraan</button></div></div></div>
        <div v-if="isDriverModalVisible" @click.self="closeDriverModal" class="fixed inset-0 bg-black bg-opacity-60 z-50 flex items-center justify-center"><div class="bg-white rounded-xl shadow-2xl w-full max-w-xl"><div class="flex justify-between items-center p-6 border-b"><h3 class="text-2xl font-bold text-sutan-blue-900">{{ driverModal.mode === 'add' ? 'Tambah Supir Baru' : 'Edit Data Supir' }}</h3><button @click="closeDriverModal" class="text-gray-400 hover:text-gray-800 text-2xl">&times;</button></div><div class="p-6"><div class="grid grid-cols-2 gap-6"><div><label class="font-semibold block mb-1">Nama Lengkap</label><input type="text" v-model="driverModal.data.name" class="w-full p-2 border rounded-md bg-gray-50"></div><div><label class="font-semibold block mb-1">No. Telepon</label><input type="text" v-model="driverModal.data.phone" class="w-full p-2 border rounded-md bg-gray-50"></div><div><label class="font-semibold block mb-1">Jenis SIM</label><select v-model="driverModal.data.licenseType" class="w-full p-2 border rounded-md bg-gray-50"><option>A Umum</option><option>B1 Umum</option><option>B2 Umum</option></select></div><div><label class="font-semibold block mb-1">Status</label><select v-model="driverModal.data.status" class="w-full p-2 border rounded-md bg-gray-50"><option>Standby</option><option>Libur</option></select></div></div></div><div class="p-6 border-t flex justify-end"><button @click="saveDriver" class="bg-sutan-blue-800 text-white font-bold py-2 px-8 rounded-lg hover:bg-sutan-blue-900">Simpan Data</button></div></div></div>
    </div>

    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="app.js"></script>
</body>
</html>